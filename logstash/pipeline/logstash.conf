input {
  kafka {
    bootstrap_servers => "${HOST_IP:-127.0.0.1}:${KAFKA_PORT:-9092}"
    topics => ["registered_user"]
    codec => "json"
    consumer_threads => 1
  }
}

filter {
  # Example: mark source and make sure timestamp is parsed (adjust if needed)
  mutate {
    add_field => { "received_at" => "%{@timestamp}" }
    add_field => { "source" => "kafka" }
  }
}

output {
  # send to ES
  elasticsearch {
    hosts => ["http://${HOST_IP:-127.0.0.1}:${ES_PORT:-9200}"]
    index => "logstash-%{+YYYY.MM.dd}"
    # If ES requires auth, add user/password here (not recommended in plaintext)
    # user => "elastic"
    # password => "changeme"
  }

  # print to Logstash container stdout for debugging
  stdout { codec => rubydebug }
}
